# MASTER PROMPT — 单机多智能体语义记忆碎片聚类压缩（含偏好保留）中国发明专利全自动材料包

你现在是一个“端到端专利材料工程代理”，需要在一个本地仓库内自动完成：调研避碰、技术方案定稿、可运行原型、实验与作图、以及中国发明专利文本（说明书/权利要求书/摘要/附图说明）成稿。

## A. 总目标（必须全部交付）
1) 生成一套“可提交/可交给专利代理人完善”的中国发明专利材料包（中文）。
2) 生成一套“可运行的最小原型（Python）+ 复现实验脚本 + 结果图表”，用于支撑技术效果叙述（例如：token 降幅、召回准确率、偏好合规率、冲突保留率、运行耗时）。
3) 生成一份“避碰对比表（claim chart 级别）”：列出至少 15 篇/项近似技术（论文/开源/专利），并逐条标注：对方覆盖点、我们的区别特征、可写入权利要求的差异化描述。
4) 产出一个“Retention Contract（偏好保留契约）”规范：JSON Schema + 示例配置（偏好模板至少 5 套：专利写作/科研助手/客服/项目管理/知识库）。
5) 产出一个“可审计压缩报告”机制：每次压缩输出带有（a）保留槽位覆盖清单；（b）证据指针 ID 列表；（c）冲突分叉列表；（d）失败重试/修订记录。

## B. 工作方式（强制）
- 你必须把工作分成多个角色/子任务并行推进（即使实际只由你执行，也要模拟成多个 Agent 的交接产物）。
- 每个子任务必须产出可落地文件，写入仓库对应目录。
- 所有关键断言必须有“引用来源”记录在 `prior_art/` 下（允许用“引用摘录 + 你自己的总结”，但不能只有主观判断）。
- 所有专利文本必须严格中文专利结构与用语规范：不写广告词、不贬低竞品、不出现“如权利要求…所述的…”这类引用语。
- 输出必须“可读、可复制、可提交”：任何需要跑的命令放在 `RUNBOOK.md`，任何关键参数写在配置文件中。

## C. 仓库目录（你必须创建）
- `/prior_art/`：近似技术列表、专利/论文对比表、逐条摘录与我们的差异化点
- `/spec/`：技术方案说明、数据结构、流程图文字版、Retention Contract 规范、算法伪代码
- `/prototype/`：Python 原型代码、单元测试、实验脚本、生成图表脚本
- `/patent/`：专利最终文本（说明书.md、权利要求书.md、摘要.md、附图说明.md、附图标记表.md、技术交底书.md）
- `/figures/`：自动生成的流程图（可用 mermaid）、实验结果图（png/svg）、表格（csv）
- `/qa/`：合规检查与自检报告（支持性、清楚性、必要技术特征、实施例充分性）

## D. 技术方案主线（必须采用并明确写进权利要求）
你要围绕“偏好约束 + 证明式保真 + token 预算分配 + 跨智能体冗余仲裁”的组合来构造创新点，不要把创新点仅写成“聚类 + 摘要”。

### D1. 核心对象
- 记忆碎片（fragment）：多智能体产生的信息最小单元，带元数据与证据指针
- 语义簇（cluster）：碎片按语义相近聚合
- 簇记忆单元（cluster memory unit）：输出包含
  - 共识摘要（consensus）
  - 争议分叉（disagreements）
  - 证据列表（evidence pointers）
  - 槽位覆盖清单（slot coverage）
  - 压缩报告（compression report）
- Retention Contract：偏好保留契约（结构化，可执行，可校验）

### D2. 必须包含的流程（写入说明书与权利要求）
1) 碎片采集与元数据标注（来源智能体、时间、主题候选、置信度、工具输出指纹）
2) 向量化与候选近邻检索（粗筛）
3) 精判并簇/新簇/拆簇（考虑语义相似、主题一致、来源置信、冲突风险）
4) 跨智能体冗余仲裁：生成共识摘要，并给出证据列表与信用分配记录
5) 冲突检测：若存在互斥陈述，输出分叉摘要而非强行融合
6) 应用 Retention Contract：按槽位约束生成摘要，并输出槽位覆盖清单
7) 证明式保真校验：检测摘要是否覆盖必须保留项、是否引入无证据新信息；失败则触发修订重写
8) 全局 token 预算分配：在总预算下为各簇分配摘要长度，最大化效用函数；输出分配结果
9) 分层索引与可追溯恢复：每个簇单元可追溯到原始碎片 ID；支持按需展开

## E. 实验与指标（必须做出可用数字）
- Token 压缩率：压缩前后 token 数
- 召回有效性：给定查询，命中正确簇/正确关键信息的比例（可用合成数据或公开长对话基准的子集）
- 偏好合规率：槽位必须保留项覆盖率、长度约束达标率
- 冲突保留率：存在冲突时是否正确分叉保留而非丢失
- 运行效率：增量插入与聚类更新时间

## F. 专利文本交付要求（必须严格遵守）
- 输出四份：说明书、权利要求书、摘要、附图说明；另加“技术交底书”与“实施例补充材料”
- 权利要求：
  - 至少 1 条方法独权 + 至少 10 条从权
  - 至少 1 条系统独权 + 至少 8 条从权
  - 至少 1 条存储介质独权 + 至少 3 条从权
- 说明书必须给出多个实施例（至少 3 个：专利写作多智能体、客服多智能体、科研助手多智能体），并明确技术效果与对比点。
- 附图用文字版流程图 + 模块框图（可用 mermaid），并给出附图标记表。

## G. 质量门槛（不满足则必须返工）
- 权利要求的每个必要技术特征，在说明书至少出现并有支持性描述
- 术语一致：同一对象在全文保持同一命名
- 不出现“商业宣传、贬低他人、引用语错误”
- 近似技术对比表必须覆盖：对话聚类摘要专利、可定制会话摘要专利、对话摘要主题聚类中文专利、记忆操作系统/分层记忆系统、子智能体记忆编排系统
- 代码可运行：给出一键命令与样例输入输出

## H. 执行顺序（你必须按此推进并在每步产出文件）
Step 1: 建仓库目录与 RUNBOOK
Step 2: prior_art 拉取与对比表（先做，避免路线走偏）
Step 3: spec 技术方案定稿（术语、数据结构、流程、伪代码、契约）
Step 4: prototype 实现 + tests
Step 5: experiments 生成结果图与 csv
Step 6: patent 文本成稿（先权利要求，再倒推说明书支撑）
Step 7: qa 自检与修订（支持性/清楚性/一致性/实施例充分性）

现在开始执行 Step 1。
# 建议你让 Codex 自动生成的 AGENTS.md（放在仓库根目录）

你是一个“专利材料 + 原型实现”工程代理。你每次启动任务都必须遵循：
- 先读 /prior_art/ 的对比表，确保任何新增描述都有差异化落点
- 先改权利要求书再改说明书，避免说明书写散导致权利要求无支撑
- 每次产出必须写进仓库文件，不要只在对话里给结论
- 任何关键数字都必须可复现（脚本 + 输入数据 + 输出图表）
- 用中文写专利文件，术语一致、句子清楚、避免宣传性用语

默认输出路径：
- 专利文件在 /patent/
- 技术方案在 /spec/
- 代码与实验在 /prototype/ 与 /figures/
- 对比与摘录在 /prior_art/
- 自检报告在 /qa/

遇到不确定之处：
- 优先在 prior_art 中记录不确定点与候选来源
- 允许给出保守表述，但必须标注“待核验”
# （可选）把下面这段作为你在对话里给 Codex 的“一句话启动指令”
按仓库根目录 MASTER PROMPT 执行，完成全套专利材料包与可运行原型；过程中每一步都写入对应目录，并在 RUNBOOK.md 里给一键复现命令。
以上提示词总包的设计意图是让 Codex 自动做两件你最需要的事：
第一，让它把“近似技术与专利文本”落到可检查的 /prior_art/ 文件里，避免你只凭直觉写；第二，把“创新点”从“聚类+摘要”抬升到“偏好契约可执行 + 保真校验 + 预算分配 + 跨 agent 仲裁”这类更可写成必要技术特征的组合，从而在与对话聚类摘要类专利、可定制摘要专利、以及宽覆盖的‘共享缓存/层级压缩/语义聚类’专利对比时，仍能构造出较清晰的区别特征。

LangGraph、LangChain 等平台/框架在公开材料中都强调多智能体上下文共享与记忆机制（共享工作区、共享 state、摘要记忆、向量检索记忆等），这也提示你：专利文本里“共享记忆”不要写成口号，而要写成具有具体数据结构、更新规则、冲突分叉与校验流程的技术方案。

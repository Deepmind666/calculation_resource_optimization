# 权利要求书（初稿）

## 一、方法类权利要求

1. 一种面向单机多智能体协作场景的语义记忆碎片聚类压缩与偏好保留方法，其特征在于，所述方法由处理器执行并至少包括：
   - 采集多智能体在任务执行过程中产生的记忆碎片，并为每个记忆碎片写入来源智能体标识、时间戳、工具输出指纹、置信度与可追溯指针；
   - 对记忆碎片进行向量化，基于近邻检索得到候选语义簇；
   - 按照语义相似度、主题一致性、来源置信度与冲突风险对候选语义簇执行精判，输出并簇、新簇或拆簇决策；
   - 对同簇内来自不同智能体的事实陈述执行跨智能体冗余仲裁，生成共识陈述与证据列表；
   - 对同簇陈述执行冲突检测，在检测到互斥陈述时输出分叉摘要；
   - 根据结构化偏好保留契约生成簇摘要，所述偏好保留契约至少定义必选槽位、最小覆盖率与来源权重；
   - 对簇摘要执行保真校验，判断是否覆盖必须保留项以及是否引入无证据新信息，不满足条件时触发修订重写；
   - 在全局 token 预算约束下对多个语义簇进行摘要长度分配优化；
   - 建立簇级分层索引，使簇摘要可追溯至原始记忆碎片。

2. 根据权利要求1所述的方法，其特征在于，所述记忆碎片定义为不可变事件，至少包含 fragment_id、content、source_agent、timestamp、tool_fingerprint、trace_pointer 与 embedding 字段。

3. 根据权利要求1所述的方法，其特征在于，所述候选语义簇检索采用两阶段策略，第一阶段采用 ANN 或 LSH 获取候选集合，第二阶段执行精判。

4. 根据权利要求1所述的方法，其特征在于，所述跨智能体冗余仲裁基于信用分配函数计算陈述采纳权重，所述采纳权重至少由来源置信度、被引用频次与工具一致性构成。

5. 根据权利要求1所述的方法，其特征在于，所述冲突检测采用自然语言推理模型或规则分类器，输出包含争议点 A/B 及证据指针的分叉结构。

6. 根据权利要求1所述的方法，其特征在于，所述偏好保留契约为结构化对象，至少包括 required_slots、slot_constraints、source_weights、topic_policy、length_constraints 与 validation_policy。

7. 根据权利要求6所述的方法，其特征在于，所述 required_slots 至少包括 facts、procedure-steps、parameter-ranges、risks、citations 与 disagreements 中的三个以上。

8. 根据权利要求1所述的方法，其特征在于，所述保真校验至少包括蕴含校验、矛盾校验与槽位覆盖率校验，且每次校验结果写入审计日志。

9. 根据权利要求8所述的方法，其特征在于，所述修订重写在达到最大重写轮次仍不满足校验条件时，输出保守摘要并附证据直引列表。

10. 根据权利要求1所述的方法，其特征在于，所述全局 token 预算分配满足约束 Σli≤B，并基于效用函数 ΣUi(li) 最大化确定每个语义簇的摘要长度。

11. 根据权利要求1所述的方法，其特征在于，所述审计输出至少包括槽位覆盖清单、证据指针 ID 列表、冲突分叉列表与重写记录。

## 二、系统类权利要求

12. 一种面向单机多智能体协作场景的语义记忆管理系统，其特征在于，包括：
   - 碎片采集与标注模块，用于采集记忆碎片并写入元数据；
   - 候选检索与精判模块，用于生成候选语义簇并执行并簇、新簇或拆簇决策；
   - 冗余仲裁模块，用于对同簇多智能体陈述执行信用分配并生成共识陈述；
   - 冲突检测模块，用于生成争议分叉；
   - 偏好契约执行模块，用于按照槽位约束生成簇摘要；
   - 保真校验与修订模块，用于执行蕴含/矛盾/覆盖率校验并触发重写；
   - 预算分配模块，用于在总预算下分配簇摘要长度；
   - 分层索引模块，用于提供簇摘要到原始碎片的追溯路径。

13. 根据权利要求12所述的系统，其特征在于，所述碎片采集与标注模块将工具调用结果编码为 tool_fingerprint 并写入 trace_pointer。

14. 根据权利要求12所述的系统，其特征在于，所述候选检索与精判模块采用多索引候选召回与阈值化精判策略。

15. 根据权利要求12所述的系统，其特征在于，所述冗余仲裁模块输出包含采纳陈述、降级陈述与待核验陈述的仲裁结果。

16. 根据权利要求12所述的系统，其特征在于，所述冲突检测模块输出结构化分叉摘要，所述分叉摘要包含共识部分、争议部分与仲裁建议。

17. 根据权利要求12所述的系统，其特征在于，所述偏好契约执行模块支持领域模板切换，至少包括专利写作、科研助手、客服、项目管理和知识库模板。

18. 根据权利要求12所述的系统，其特征在于，所述保真校验与修订模块在每轮校验后将失败原因写入 rewrite_history 字段。

19. 根据权利要求12所述的系统，其特征在于，所述预算分配模块采用边际收益迭代或拉格朗日松弛求解摘要长度分配。

20. 根据权利要求12所述的系统，其特征在于，所述分层索引模块至少包括簇摘要索引层与证据索引层。

## 三、存储介质类权利要求

21. 一种计算机可读存储介质，其上存储有计算机程序，所述程序在被处理器执行时实现权利要求1至11任一项所述的方法。

22. 根据权利要求21所述的计算机可读存储介质，其特征在于，所述程序包括用于执行偏好保留契约解析与校验的指令。

23. 根据权利要求21所述的计算机可读存储介质，其特征在于，所述程序包括用于执行冲突检测与分叉摘要生成的指令。

24. 根据权利要求21所述的计算机可读存储介质，其特征在于，所述程序包括用于输出审计报告的指令，所述审计报告至少含覆盖率、证据链与修订记录。

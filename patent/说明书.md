# 说明书（初稿）

## 一、技术领域
本发明涉及人工智能与软件工程技术领域，具体涉及一种面向单机多智能体协作场景的语义记忆碎片聚类压缩与偏好保留方法、系统及存储介质。

## 二、背景技术
在多智能体协作过程中，规划、执行、检索、验证、写作等智能体会持续产生对话记录、工具输出与中间推理结果。若将上述信息无约束堆积于上下文，容易出现上下文膨胀、关键事实丢失、冲突信息覆盖与检索效率下降问题。

现有方案通常关注：
1. 对话聚类后输出代表摘要；
2. 按固定摘要模板进行压缩；
3. 构建共享记忆池进行多智能体访问。

但上述方案普遍缺少以下工程能力：
1. 将“用户偏好”转化为可执行、可校验的结构化契约；
2. 对摘要输出执行证据级保真校验并自动修订；
3. 在全局 token 预算下进行跨簇长度分配优化；
4. 对跨智能体冗余陈述执行信用分配与仲裁追溯。

## 三、发明内容

### （一）要解决的技术问题
本发明旨在解决多智能体共享记忆过程中：
1. 聚类摘要导致的关键信息遗漏；
2. 冲突陈述被强行融合造成失真；
3. 偏好约束不可执行且不可审计；
4. 固定预算下摘要长度分配不合理的问题。

### （二）技术方案
为解决上述问题，本发明提供一种语义记忆管理方案，包括：
1. 记忆碎片采集与元数据标注；
2. 候选近邻检索与精判并簇；
3. 跨智能体冗余仲裁；
4. 冲突检测与分叉保留；
5. 偏好保留契约执行；
6. 证明式保真校验与自动修订；
7. 全局 token 预算分配优化；
8. 分层索引与证据追溯。

其中，所述偏好保留契约至少包括：
- required_slots；
- slot_constraints；
- source_weights；
- topic_policy；
- length_constraints；
- validation_policy。

### （三）有益效果
与现有技术相比，本发明具有以下效果：
1. 提升关键信息保留率并降低遗漏风险；
2. 保留冲突分叉，避免错误融合；
3. 在总预算约束下提升摘要资源分配效率；
4. 提供证据链与修订历史，增强可审计性。

## 四、附图说明
图1：系统模块框图。  
图2：九步处理流程图。  
图3：簇记忆单元数据结构示意图。  
图4：实验评估流程图。

## 五、具体实施方式

### （一）核心数据结构
1. Fragment：包含 `fragment_id`、`content`、`source_agent`、`timestamp`、`tool_fingerprint`、`trace_pointer`、`embedding`。
2. Cluster：包含 `cluster_id`、`fragment_ids`、`centroid`、`topic_distribution`、`conflict_risk`。
3. ClusterMemoryUnit：包含 `consensus_summary`、`disagreements`、`evidence_pointers`、`slot_coverage`、`compression_report`。
4. RetentionContract：包含槽位约束、来源权重、主题策略、长度约束与校验策略。

### （二）九步流程
步骤S1：采集碎片并标注元数据。  
步骤S2：向量化并执行候选近邻检索。  
步骤S3：基于语义相似、主题一致、来源置信与冲突风险执行精判。  
步骤S4：对同簇陈述执行信用分配，形成共识与证据列表。  
步骤S5：检测互斥陈述并输出分叉摘要。  
步骤S6：应用偏好保留契约生成槽位化摘要。  
步骤S7：执行保真校验，不满足条件则重写。  
步骤S8：执行全局预算优化分配簇摘要长度。  
步骤S9：建立分层索引并支持证据追溯恢复。

### （三）实施例1：专利写作多智能体
1. 输入：检索智能体、写作智能体、校验智能体产生的碎片集合。  
2. 契约：启用专利模板，强制保留 facts、procedure-steps、parameter-ranges、citations、disagreements。  
3. 输出：簇记忆单元与审计报告，用于权利要求与说明书写作。  
4. 效果：提高证据链完整性与权利要求支撑一致性。

### （四）实施例2：客服多智能体
1. 输入：客服响应智能体、政策检索智能体、工单核验智能体输出。  
2. 契约：启用客服模板，优先保留 decisions、todos、facts。  
3. 输出：可追溯处理摘要与争议分叉。  
4. 效果：降低处理遗漏并提升复盘效率。

### （五）实施例3：科研助手多智能体
1. 输入：文献检索智能体、实验分析智能体、写作智能体输出。  
2. 契约：启用科研模板，强制保留 citations 与 tool-results。  
3. 输出：可追溯研究摘要及冲突说明。  
4. 效果：提升结论可验证性与可复现性。

## 六、可实施性说明
本发明可由通用服务器或个人计算机实现。各模块可由软件指令完成，数据可存储于本地文件系统或数据库中，具备明确输入、处理与输出路径，能够由本领域技术人员据此实施。
